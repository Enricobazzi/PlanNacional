---
title: "1.Calling_pipeline"
author: "Enrico"
date: "9 April 2019"
output: html_document
---

With the BAMs from the 20 high coverage/depth individuals we will perform a variant calling using GATK.
Base quality score recalibration has not been conducted on the BAMs as we don't have a set of variants to mask before recalibration.
We might use the first round of calling for recalibration or not.

I will follow GATK best practices and do a primary per-sample calling, using the tool HaplotypeCaller, that will generate a GVCF file for each sample (using a GVCF specific flag while running the program).

The next step is called GVCF consolidation (GenomicsDBImport) and consists in ...

Finally I can do a joint-calling of variants (GenotypeGVCFs) using all of the GVCF files as input ...

The step of filtering and recalibration of variants will not be conducted with the best practices GATK protocol, as we are missing a reliable set of variants to mask out during this analysis. Again, we might use the first round of calling for recalibration or not.


## Preparing the data

For the final calling the data is already ready, as only the BAM files and the reference genome are needed.
I first would like to try with just one chromosome from one individual to test how the program runs.
I need to generate a BED file with the coordinates of the chromosome I want to use (A1). This information is stored in the FAI index file of the reference genome.

```
# Create a BED with coordinates from chromosome A1
cat /home/GRUPOS/grupolince/reference_genomes/felis_catus_genome/Felis_catus.Felis_catus_9.0.dna.toplevel.fa.fai | grep "A1" \
| cut -f1,2 | awk 'BEGIN {FS="\t"; OFS="\t"} {print $1, 0, $2}' > /home/ebazzicalupo/try_calling/A1_CHR_coordinates.bed

# Subset the BAM to that region only - Tried on c_ll_vl_0112 - run in a screen as I don't know how long it might take
samtools view -b -h -L /home/ebazzicalupo/try_calling/A1_CHR_coordinates.bed \
/home/ebazzicalupo/CatRef_bams/c_ll_vl_0112_cat_ref_sorted_rg_rmdup_sorted_indelrealigner.bam \
> /home/ebazzicalupo/try_calling/c_ll_vl_0112_cat_ref_chrA1.bam

```
